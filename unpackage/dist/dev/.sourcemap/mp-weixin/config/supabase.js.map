{"version":3,"file":"supabase.js","sources":["config/supabase.js"],"sourcesContent":["/**\r\n * Supabase 配置文件\r\n * 用于 uni-app 项目连接 Supabase 数据库\r\n */\r\n\r\n// 注意：在生产环境中，这些敏感信息应该通过环境变量管理\r\n// 在 uni-app 中，可以通过条件编译区分不同环境\r\n\r\n// 根据平台获取配置\r\nlet SUPABASE_URL = 'https://rzmnzblywphmtydbjtkj.supabase.co'\r\nlet SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6bW56Ymx5d3BobXR5ZGJqdGtqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MzcxNTMsImV4cCI6MjA4MTQxMzE1M30.AjWEvOQCBfY8hldwoXTewiUUgmPzqzp2LpbX3FBLpfc'\r\n\r\n// #ifdef H5\r\n// H5 环境配置\r\nSUPABASE_URL = process.env.VUE_APP_SUPABASE_URL || 'https://rzmnzblywphmtydbjtkj.supabase.co'\r\nSUPABASE_ANON_KEY = process.env.VUE_APP_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6bW56Ymx5d3BobXR5ZGJqdGtqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MzcxNTMsImV4cCI6MjA4MTQxMzE1M30.AjWEvOQCBfY8hldwoXTewiUUgmPzqzp2LpbX3FBLpfc'\r\n// #endif\r\n\r\n// #ifdef MP-WEIXIN\r\n// 微信小程序环境配置\r\n// 需要在 manifest.json 中配置网络请求域名白名单\r\n// ⚠️ 请替换为你的实际 Supabase 配置\r\nSUPABASE_URL = 'https://rzmnzblywphmtydbjtkj.supabase.co' // 请替换为你的 Supabase 项目 URL，例如：https://xxxxx.supabase.co\r\nSUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6bW56Ymx5d3BobXR5ZGJqdGtqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MzcxNTMsImV4cCI6MjA4MTQxMzE1M30.AjWEvOQCBfY8hldwoXTewiUUgmPzqzp2LpbX3FBLpfc' // 请替换为你的 Supabase Anon Key\r\n// #endif\r\n\r\n// #ifdef APP-PLUS\r\n// App 环境配置\r\n// ⚠️ 请替换为你的实际 Supabase 配置\r\nSUPABASE_URL = 'https://rzmnzblywphmtydbjtkj.supabase.co' // 请替换为你的 Supabase 项目 URL\r\nSUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6bW56Ymx5d3BobXR5ZGJqdGtqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MzcxNTMsImV4cCI6MjA4MTQxMzE1M30.AjWEvOQCBfY8hldwoXTewiUUgmPzqzp2LpbX3FBLpfc' // 请替换为你的 Supabase Anon Key\r\n// #endif\r\n\r\n/**\r\n * Supabase 客户端初始化\r\n * 注意：uni-app 需要使用 @supabase/supabase-js 的兼容版本\r\n * 或者使用 HTTP 请求方式调用 Supabase REST API\r\n */\r\nexport const supabaseConfig = {\r\n  url: SUPABASE_URL,\r\n  anonKey: SUPABASE_ANON_KEY,\r\n  // Supabase REST API 端点\r\n  restUrl: `${SUPABASE_URL}/rest/v1`,\r\n  // 表名常量\r\n  tables: {\r\n    users: 'users',\r\n    scenes: 'scenes',\r\n    userScenes: 'user_scenes',\r\n    gameRecords: 'game_records'\r\n  }\r\n}\r\n\r\n/**\r\n * 获取 Supabase REST API 请求头\r\n */\r\nexport function getSupabaseHeaders() {\r\n  return {\r\n    'apikey': supabaseConfig.anonKey,\r\n    'Authorization': `Bearer ${supabaseConfig.anonKey}`,\r\n    'Content-Type': 'application/json',\r\n    'Prefer': 'return=representation'\r\n  }\r\n}\r\n\r\n/**\r\n * Supabase API 请求封装\r\n * 由于 uni-app 可能不支持 @supabase/supabase-js，使用 HTTP 请求方式\r\n */\r\nexport class SupabaseClient {\r\n  constructor() {\r\n    this.url = supabaseConfig.restUrl\r\n    this.headers = getSupabaseHeaders()\r\n  }\r\n\r\n  /**\r\n   * 通用请求方法\r\n   */\r\n  async request(table, options = {}) {\r\n    const {\r\n      method = 'GET',\r\n      query = {},\r\n      body = null,\r\n      select = '*',\r\n      filters = []\r\n    } = options\r\n\r\n    let url = `${this.url}/${table}?select=${select}`\r\n    \r\n    // 添加查询参数（limit/offset/order 直接使用，不加 eq. 前缀）\r\n    if (Object.keys(query).length > 0) {\r\n      Object.entries(query).forEach(([key, value]) => {\r\n        if (value === undefined || value === null || value === '') return\r\n        if (key === 'limit' || key === 'offset') {\r\n          url += `&${key}=${value}`\r\n        } else if (key === 'order') {\r\n          // 例如：play_count.desc\r\n          url += `&order=${value}`\r\n        } else {\r\n          // 其他查询键默认使用 eq.\r\n          url += `&${key}=eq.${encodeURIComponent(value)}`\r\n        }\r\n      })\r\n    }\r\n\r\n    // 添加过滤器\r\n    if (filters.length > 0) {\r\n      filters.forEach(filter => {\r\n        url += `&${filter}`\r\n      })\r\n    }\r\n\r\n    try {\r\n      const response = await uni.request({\r\n        url,\r\n        method,\r\n        header: this.headers,\r\n        data: body,\r\n        timeout: 10000\r\n      })\r\n\r\n      if (response.statusCode >= 200 && response.statusCode < 300) {\r\n        return { data: response.data, error: null }\r\n      } else {\r\n        return { data: null, error: response.data }\r\n      }\r\n    } catch (error) {\r\n      console.error('Supabase request error:', error)\r\n      return { data: null, error: error.message }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 查询数据\r\n   */\r\n  async select(table, options = {}) {\r\n    return this.request(table, { ...options, method: 'GET' })\r\n  }\r\n\r\n  /**\r\n   * 插入数据\r\n   */\r\n  async insert(table, data) {\r\n    return this.request(table, {\r\n      method: 'POST',\r\n      body: Array.isArray(data) ? data : [data]\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 更新数据\r\n   */\r\n  async update(table, filters, data) {\r\n    let url = `${this.url}/${table}`\r\n    \r\n    // 构建过滤条件\r\n    if (filters && Object.keys(filters).length > 0) {\r\n      const filterString = Object.entries(filters)\r\n        .map(([key, value]) => `${key}=eq.${encodeURIComponent(value)}`)\r\n        .join('&')\r\n      url += `?${filterString}`\r\n    }\r\n\r\n    try {\r\n      const response = await uni.request({\r\n        url,\r\n        method: 'PATCH',\r\n        header: this.headers,\r\n        data\r\n      })\r\n\r\n      if (response.statusCode >= 200 && response.statusCode < 300) {\r\n        return { data: response.data, error: null }\r\n      } else {\r\n        return { data: null, error: response.data }\r\n      }\r\n    } catch (error) {\r\n      console.error('Supabase update error:', error)\r\n      return { data: null, error: error.message }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 删除数据\r\n   */\r\n  async delete(table, filters) {\r\n    let url = `${this.url}/${table}`\r\n    \r\n    if (filters && Object.keys(filters).length > 0) {\r\n      const filterString = Object.entries(filters)\r\n        .map(([key, value]) => `${key}=eq.${encodeURIComponent(value)}`)\r\n        .join('&')\r\n      url += `?${filterString}`\r\n    }\r\n\r\n    try {\r\n      const response = await uni.request({\r\n        url,\r\n        method: 'DELETE',\r\n        header: this.headers\r\n      })\r\n\r\n      if (response.statusCode >= 200 && response.statusCode < 300) {\r\n        return { data: response.data, error: null }\r\n      } else {\r\n        return { data: null, error: response.data }\r\n      }\r\n    } catch (error) {\r\n      console.error('Supabase delete error:', error)\r\n      return { data: null, error: error.message }\r\n    }\r\n  }\r\n}\r\n\r\n// 导出单例\r\nexport const supabase = new SupabaseClient()\r\n\r\nexport default supabase\r\n\r\n"],"names":["uni"],"mappings":"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"}