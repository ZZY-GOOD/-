{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"app-container\">\r\n\t\t<!-- 核心内容区域 -->\r\n\t\t<view class=\"main-content\">\r\n\t\t\t<!-- 场景选择部分 -->\r\n\t\t\t<view class=\"scene-section\">\r\n\t\t\t<!-- 欢迎描述 -->\r\n\t\t\t<view class=\"welcome-card\">\r\n\t\t\t\t<text class=\"welcome-title\">欢迎来到哄一哄他（她）</text>\r\n\t\t\t\t<text class=\"welcome-desc\">\r\n\t\t\t\t\t本程序基于 AI 技术，你需要使用语言技巧和沟通能力，\r\n\t\t\t\t\t在限定次数内让对方原谅你，这并不容易。\r\n\t\t\t\t</text>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<text class=\"section-title\">\r\n\t\t\t\t<text class=\"emoji\">✨</text> 选择一个场景，然后开始模拟哄你的虚拟男/女朋友吧\r\n\t\t\t</text>\r\n\t\t\t\t\r\n\t\t\t\t<!-- 排序选择下拉框 -->\r\n\t\t\t\t<picker @change=\"onSortChange\" :value=\"sortIndex\" :range=\"sortOptions\" class=\"scene-picker\">\r\n\t\t\t\t\t<view class=\"picker-text\">{{sortOptions[sortIndex]}}</view>\r\n\t\t\t\t</picker>\r\n\t\t\t\t\r\n\t\t\t\t<!-- 场景分类标签 -->\r\n\t\t\t\t<view class=\"category-tabs\">\r\n\t\t\t\t\t<view \r\n\t\t\t\t\t\tv-for=\"(category, index) in categories\" \r\n\t\t\t\t\t\t:key=\"index\"\r\n\t\t\t\t\t\tclass=\"category-tab\"\r\n\t\t\t\t\t\t:class=\"{ active: activeCategory === category.name }\"\r\n\t\t\t\t\t\t@click=\"onCategoryChange(category.name)\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{{category.name}} ({{category.count}})\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<!-- 场景列表 -->\r\n\t\t\t\t<view class=\"scene-list\">\r\n\t\t\t\t\t<view \r\n\t\t\t\t\t\tv-for=\"(scene, index) in filteredScenes\" \r\n\t\t\t\t\t\t:key=\"index\"\r\n\t\t\t\t\t\tclass=\"scene-item\"\r\n\t\t\t\t\t\t@click=\"onSceneSelect(scene)\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<text class=\"scene-title\">{{scene.title}}</text>\r\n\t\t\t\t\t\t<text class=\"scene-stats\">{{scene.times}}次(胜率 {{scene.winRate}}%)</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport { sceneService, gameRecordService } from '@/utils/supabase-helper.js'\r\n\t\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttitle: '哄哄模拟器',\r\n\t\t\t\tsortIndex: 0,\r\n\t\t\t\tsortOptions: ['默认', '最新', '最热', '胜率最高', '胜率最低'],\r\n\t\t\t\tcategories: [],\r\n\t\t\t\tactiveCategory: '全部',\r\n\t\t\t\tscenes: [],\r\n\t\t\t\tloadingScenes: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\tthis.loadScenes()\r\n\t\t},\r\n\tonShow() {\r\n\t\t// 每次返回首页时刷新场景统计数据（挑战次数、胜率）\r\n\t\tthis.loadScenes()\r\n\t\tthis.checkLoginAtStartup()\r\n\t},\r\n\t// #ifdef MP-WEIXIN\r\n\tonShareAppMessage() {\r\n\t\treturn {\r\n\t\t\ttitle: '哄一哄他（她）- AI情感对话游戏，挑战你的沟通技巧！',\r\n\t\t\tpath: '/pages/index/index',\r\n\t\t\timageUrl: '' // 可选：分享图片，建议尺寸 5:4\r\n\t\t}\r\n\t},\r\n\tonShareTimeline() {\r\n\t\treturn {\r\n\t\t\ttitle: '哄一哄他（她）- AI情感对话游戏，挑战你的沟通技巧！',\r\n\t\t\tquery: '',\r\n\t\t\timageUrl: '' // 可选：分享图片，建议尺寸 1:1（500x500px）\r\n\t\t}\r\n\t},\r\n\t// #endif\r\n\t\tcomputed: {\r\n\t\t\t// 过滤并排序场景列表（支持多分类）\r\n\t\t\tfilteredScenes() {\r\n\t\t\t\tlet list = this.activeCategory === '全部'\r\n\t\t\t\t\t? this.scenes\r\n\t\t\t\t\t: this.scenes.filter(scene => {\r\n\t\t\t\t\t\t// 处理多分类（逗号分隔）\r\n\t\t\t\t\t\tconst categories = (scene.category || '').split(',').map(c => c.trim())\r\n\t\t\t\t\t\treturn categories.includes(this.activeCategory)\r\n\t\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tconst option = this.sortOptions[this.sortIndex]\r\n\t\t\t\tif (option === '最新') {\r\n\t\t\t\t\tlist = [...list].sort((a, b) => new Date(b.created_at || 0) - new Date(a.created_at || 0))\r\n\t\t\t\t} else if (option === '最热') {\r\n\t\t\t\t\tlist = [...list].sort((a, b) => (b.play_count || 0) - (a.play_count || 0))\r\n\t\t\t\t} else if (option === '胜率最高') {\r\n\t\t\t\t\tlist = [...list].sort((a, b) => (b.win_rate || 0) - (a.win_rate || 0))\r\n\t\t\t\t} else if (option === '胜率最低') {\r\n\t\t\t\t\tlist = [...list].sort((a, b) => (a.win_rate || 0) - (b.win_rate || 0))\r\n\t\t\t\t}\r\n\t\t\t\treturn list\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 进入首页时检查是否已登录，如果未登录则跳转到个人中心触发登录弹窗\r\n\t\t\tcheckLoginAtStartup() {\r\n\t\t\t\tconst userId = uni.getStorageSync('userId') || ''\r\n\t\t\t\tconst userName = uni.getStorageSync('userName') || ''\r\n\t\t\t\tconst userAvatar = uni.getStorageSync('userAvatar') || ''\r\n\t\t\t\t// 没有任何用户信息时，引导到个人中心登录\r\n\t\t\t\tif (!userId && !userName && !userAvatar) {\r\n\t\t\t\t\tuni.switchTab({ url: '/pages/profile/profile' })\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 从数据库加载场景\r\n\t\t\tasync loadScenes() {\r\n\t\t\t\tthis.loadingScenes = true\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst { data, error } = await sceneService.getAllScenes({\r\n\t\t\t\t\t\tstatus: 'active',\r\n\t\t\t\t\t\tlimit: 100,\r\n\t\t\t\t\t\torderBy: 'play_count',\r\n\t\t\t\t\t\torder: 'desc'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tif (error) {\r\n\t\t\t\t\t\tconsole.error('加载场景失败:', error)\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '加载场景失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 额外获取全局统计（从 game_records 计算，确保最新）\r\n\t\t\t\t\tconst { data: globalStats } = await gameRecordService.getGlobalSceneStats()\r\n\r\n\t\t\t\t\tthis.scenes = (data || []).map(item => {\r\n\t\t\t\t\t\tconst sid = item.id\r\n\t\t\t\t\t\tconst override = globalStats && globalStats[sid] ? globalStats[sid] : null\r\n\t\t\t\t\t\tconst playCount = override ? override.playCount : (item.play_count ?? 0)\r\n\t\t\t\t\t\tconst winRateRaw = override ? override.winRate : (item.win_rate ?? 0)\r\n\t\t\t\t\t\t// 胜率显示到小数点后一位\r\n\t\t\t\t\t\tconst winRateDisplay = Number(winRateRaw || 0).toFixed(1)\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tid: item.id,\r\n\t\t\t\t\t\t\ttitle: item.title,\r\n\t\t\t\t\t\t\tcategory: item.category || '其他',\r\n\t\t\t\t\t\t\t// 兼容展示字段\r\n\t\t\t\t\t\t\ttimes: playCount,\r\n\t\t\t\t\t\t\twinRate: winRateDisplay,\r\n\t\t\t\t\t\t\tplay_count: playCount,\r\n\t\t\t\t\t\t\twin_rate: Number(winRateRaw) || 0,\r\n\t\t\t\t\t\t\tcreated_at: item.created_at\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// 分类标签统计（支持多分类，用逗号分隔）\r\n\t\t\t\t\tconst categoryMap = {}\r\n\t\t\t\t\tthis.scenes.forEach(s => {\r\n\t\t\t\t\t\t// 处理多分类（逗号分隔）\r\n\t\t\t\t\t\tconst categories = (s.category || '').split(',').map(c => c.trim()).filter(c => c)\r\n\t\t\t\t\t\tif (categories.length === 0) {\r\n\t\t\t\t\t\t\t// 如果没有分类，归类为\"其他\"\r\n\t\t\t\t\t\t\tcategoryMap['其他'] = (categoryMap['其他'] || 0) + 1\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// 每个分类都计数\r\n\t\t\t\t\t\t\tcategories.forEach(cat => {\r\n\t\t\t\t\t\t\t\tcategoryMap[cat] = (categoryMap[cat] || 0) + 1\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.categories = [{ name: '全部', count: this.scenes.length }].concat(\r\n\t\t\t\t\t\tObject.entries(categoryMap).map(([name, count]) => ({ name, count }))\r\n\t\t\t\t\t)\r\n\t\t\t\t\t// 默认选中全部\r\n\t\t\t\t\tthis.activeCategory = '全部'\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.error('加载场景异常:', err)\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '加载异常',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tthis.loadingScenes = false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 排序选择下拉框变化\r\n\t\t\tonSortChange(e) {\r\n\t\t\t\tthis.sortIndex = e.detail.value;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 分类标签点击\r\n\t\t\tonCategoryChange(category) {\r\n\t\t\t\tthis.activeCategory = category;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 场景项点击\r\n\t\t\tonSceneSelect(scene) {\r\n\t\t\t\tif (!scene || !scene.id) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '场景数据缺失',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: `/pages/dialog/dialog?id=${scene.id}`\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t/* 全局样式重置 */\r\n\tpage {\r\n\t\tbackground-color: #f8f9fa;\r\n\t\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\r\n\t}\r\n\t\r\n\t.app-container {\r\n\tmin-height: 100vh;\r\n\tpadding: 20rpx 8rpx;\r\n\t}\r\n\t\r\n\t.main-content {\r\n\tmax-width: 760rpx;\r\n\tmargin: 0 auto;\r\n\t}\r\n\t\r\n\t/* 场景选择部分 */\r\n\t.scene-section {\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 20rpx;\r\n\t\tpadding: 30rpx;\r\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\r\n\t}\r\n\t\r\n\t.section-title {\r\n\t\tfont-size: 30rpx;\r\n\t\tcolor: #333;\r\n\t\tmargin-bottom: 24rpx;\r\n\t\tdisplay: block;\r\n\t\tline-height: 48rpx;\r\n\t}\r\n\t\r\n\t.emoji {\r\n\t\tmargin-right: 10rpx;\r\n\t}\r\n\t\r\n\t/* 场景选择下拉框 */\r\n\t.scene-picker {\r\n\t\tbackground-color: #f5f5f5;\r\n\t\tborder-radius: 10rpx;\r\n\t\tpadding: 20rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\t\r\n\t.picker-text {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #666;\r\n\t}\r\n\t\r\n\t/* 分类标签 */\r\n\t.category-tabs {\r\n\t\tdisplay: flex;\r\n\t\tflex-wrap: wrap;\r\n\t\tgap: 15rpx;\r\n\t\tmargin-bottom: 30rpx;\r\n\t}\r\n\t\r\n\t.category-tab {\r\n\t\tpadding: 12rpx 20rpx;\r\n\t\tbackground-color: #f0f0f0;\r\n\t\tborder-radius: 20rpx;\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #666;\r\n\t\tcursor: pointer;\r\n\t\ttransition: all 0.3s;\r\n\t}\r\n\t\r\n\t.category-tab.active {\r\n\t\tbackground-color: #ff6b6b;\r\n\t\tcolor: #fff;\r\n\t}\r\n\t\r\n\t/* 场景列表 */\r\n\t.scene-list {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tgap: 20rpx;\r\n\t}\r\n\t\r\n\t.scene-item {\r\n\t\tbackground-color: #fafafa;\r\n\t\tborder-radius: 15rpx;\r\n\t\tpadding: 25rpx;\r\n\t\tborder-left: 6rpx solid #ff6b6b;\r\n\t\tcursor: pointer;\r\n\t\ttransition: all 0.3s;\r\n\t}\r\n\t\r\n\t.scene-item:hover {\r\n\t\tbackground-color: #f0f0f0;\r\n\t\ttransform: translateY(-2rpx);\r\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n\t}\r\n\t\r\n\t.scene-title {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333;\r\n\t\tline-height: 42rpx;\r\n\t\tmargin-bottom: 10rpx;\r\n\t\tdisplay: block;\r\n\t}\r\n\t\r\n\t.scene-stats {\r\n\t\tfont-size: 22rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t/* 欢迎描述卡片 */\r\n\t.welcome-card {\r\n\t\tbackground-color: #f9fafb;\r\n\t\tborder: 1px solid #eef2f7;\r\n\t\tborder-radius: 16rpx;\r\n\t\tpadding: 24rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\t.welcome-title {\r\n\t\tfont-size: 32rpx;\r\n\t\tfont-weight: 600;\r\n\t\tcolor: #222;\r\n\t\tdisplay: block;\r\n\t\tmargin-bottom: 12rpx;\r\n\t}\r\n\t.welcome-desc {\r\n\t\tfont-size: 26rpx;\r\n\t\tcolor: #666;\r\n\t\tline-height: 40rpx;\r\n\t\tdisplay: block;\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'D:/Hbuilder/HBuilderX.4.76.2025082103/project/first/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","gameRecordService"],"mappings":"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"}