{"version":3,"file":"dialog.js","sources":["pages/dialog/dialog.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGlhbG9nL2RpYWxvZy52dWU"],"sourcesContent":["<template>\n\t<view class=\"dialog-page\">\n\t\t<!-- å¤´éƒ¨ä¿¡æ¯ -->\n\t\t<view class=\"scene-header\" v-if=\"scene\">\n\t\t\t<view class=\"scene-title\">{{ scene.title }}</view>\n\t\t\t<view class=\"meta-row\">\n\t\t\t\t<view class=\"meta-item\">\n\t\t\t\t\t<text class=\"meta-label\">åŸè°…å€¼</text>\n\t\t\t\t\t<view class=\"bar\">\n\t\t\t\t\t\t<view class=\"bar-fill\" :style=\"{ width: forgivenessPercent + '%' }\"></view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<text class=\"meta-value\">{{ forgiveness }}/100</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"meta-item turns\">\n\t\t\t\t\t<text class=\"meta-label\">èŠå¤©è½®æ¬¡</text>\n\t\t\t\t\t<text class=\"meta-value\">{{ currentTurn }}/{{ maxTurns }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- èŠå¤©åŒº -->\n\t\t<scroll-view class=\"chat-list\" :class=\"{ 'game-ended': gameEnded }\" :scroll-y=\"true\" scroll-with-animation :scroll-into-view=\"lastMsgId\">\n\t\t\t<view\n\t\t\t\tv-for=\"(msg, idx) in messages\"\n\t\t\t\t:key=\"msg.id\"\n\t\t\t\t:id=\"msg.id\"\n\t\t\t\tclass=\"chat-item\"\n\t\t\t\t:class=\"msg.role\"\n\t\t\t>\n\t\t\t\t<view class=\"avatar-wrapper\">\n\t\t\t\t\t<image class=\"avatar\" :src=\"msg.role === 'ai' ? getAiAvatar(msg.forgiveness) : userAvatar\" mode=\"aspectFill\" />\n\t\t\t\t\t<text v-if=\"msg.role === 'ai'\" class=\"avatar-expression\">{{ getExpression(msg.forgiveness) }}</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"bubble\">\n\t\t\t\t\t<text class=\"msg-text\">{{ msg.text }}</text>\n\t\t\t\t\t<text v-if=\"msg.forgivenessChange\" class=\"forgive-change\">{{ msg.forgivenessChange }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</scroll-view>\n\n\t\t<!-- æ¸¸æˆç»“æŸæç¤º -->\n\t\t<view v-if=\"gameEnded\" class=\"result-banner\" :class=\"gameResult.success ? 'success' : 'failed'\">\n\t\t\t<text class=\"result-text\">{{ gameResult.message }}</text>\n\t\t</view>\n\n\t\t<!-- è¾“å…¥åŒºï¼ˆæ¸¸æˆè¿›è¡Œä¸­ï¼‰ -->\n\t\t<view v-if=\"!gameEnded\" class=\"input-area\">\n\t\t\t<textarea\n\t\t\t\tclass=\"text-input multiline\"\n\t\t\t\tv-model=\"inputText\"\n\t\t\t\t:disabled=\"actionLocked\"\n\t\t\t\tplaceholder=\"å¿«ï¼Œè¯´ç‚¹ä»€ä¹ˆ\"\n\t\t\t\tauto-height\n\t\t\t\t:maxlength=\"-1\"\n\t\t\t/>\n\t\t\t<button class=\"send-btn\" type=\"primary\" :disabled=\"actionLocked\" @click=\"handleSend\">å‘é€</button>\n\t\t</view>\n\n\t\t<!-- æ“ä½œæŒ‰é’®ï¼ˆæ¸¸æˆç»“æŸåï¼‰ -->\n\t\t<view v-if=\"gameEnded\" class=\"action-buttons\">\n\t\t\t<button class=\"action-btn restart-btn\" @click=\"handleRestart\">é‡å¼€</button>\n\t\t\t<button class=\"action-btn return-btn\" @click=\"handleReturn\">è¿”å›</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nimport { sceneService, gameRecordService } from '@/utils/supabase-helper.js'\nimport { generateReply } from '@/utils/ai-service.js'\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tsceneId: '',\n\t\t\tscene: null,\n\t\t\tloading: false,\n\t\t\tinputText: '',\n\t\t\tforgiveness: 0,\n\t\t\tstartForgiveness: 0,\n\t\t\tmaxTurns: 10,\n\t\t\tcurrentTurn: 0,\n\t\t\tmessages: [],\n\t\t\tuserAvatar: '/static/user.png', // é»˜è®¤å¤´åƒï¼Œä¼šåœ¨ onLoad æ—¶ä»æœ¬åœ°å­˜å‚¨è¯»å–ç”¨æˆ·å¤´åƒ\n\t\t\taiAvatar: '/static/user.png', // TODO: éœ€è¦æ·»åŠ  /static/logo.png ä½œä¸º AI å¤´åƒ\n\t\t\tactionLocked: false,\n\t\t\tlastMsgId: '',\n\t\t\tuserId: '',\n\t\t\tforgivenessChanges: [],\n\t\t\tstartTimestamp: 0,\n\t\t\trecordSaved: false,\n\t\t\tgameEnded: false,\n\t\t\tgameResult: {\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage: ''\n\t\t\t}\n\t\t}\n\t},\n\tcomputed: {\n\t\tforgivenessPercent() {\n\t\t\tconst val = Math.max(0, Math.min(100, this.forgiveness))\n\t\t\treturn val\n\t\t}\n\t},\n\tonLoad(options) {\n\t\tif (!options || !options.id) {\n\t\t\tuni.showToast({ title: 'ç¼ºå°‘åœºæ™¯ID', icon: 'none' })\n\t\t\treturn\n\t\t}\n\t\tthis.sceneId = options.id\n\t\tthis.loadUser()\n\t\tthis.initScene()\n\t},\n\t// #ifdef MP-WEIXIN\n\tonShareAppMessage() {\n\t\tconst sceneTitle = this.scene?.title || 'å“„ä¸€å“„ä»–ï¼ˆå¥¹ï¼‰'\n\t\tconst shareTitle = this.gameEnded\n\t\t\t? `${sceneTitle} - ${this.gameResult.success ? 'æŒ‘æˆ˜æˆåŠŸï¼' : 'æŒ‘æˆ˜å¤±è´¥ï¼Œæ¥è¯•è¯•å§ï¼'}`\n\t\t\t: `${sceneTitle} - æ¥æŒ‘æˆ˜è¿™ä¸ªåœºæ™¯å§ï¼`\n\t\t\n\t\treturn {\n\t\t\ttitle: shareTitle,\n\t\t\tpath: `/pages/dialog/dialog?id=${this.sceneId}`,\n\t\t\timageUrl: '' // å¯é€‰ï¼šåˆ†äº«å›¾ç‰‡ï¼Œå»ºè®®å°ºå¯¸ 5:4\n\t\t}\n\t},\n\tonShareTimeline() {\n\t\tconst sceneTitle = this.scene?.title || 'å“„ä¸€å“„ä»–ï¼ˆå¥¹ï¼‰'\n\t\tconst shareTitle = this.gameEnded\n\t\t\t? `${sceneTitle} - ${this.gameResult.success ? 'æŒ‘æˆ˜æˆåŠŸï¼' : 'æŒ‘æˆ˜å¤±è´¥ï¼Œæ¥è¯•è¯•å§ï¼'}`\n\t\t\t: `${sceneTitle} - æ¥æŒ‘æˆ˜è¿™ä¸ªåœºæ™¯å§ï¼`\n\t\t\n\t\treturn {\n\t\t\ttitle: shareTitle,\n\t\t\tquery: `id=${this.sceneId}`,\n\t\t\timageUrl: '' // å¯é€‰ï¼šåˆ†äº«å›¾ç‰‡ï¼Œå»ºè®®å°ºå¯¸ 1:1ï¼ˆ500x500pxï¼‰\n\t\t}\n\t},\n\t// #endif\n\tmethods: {\n\t\t// æ ¹æ®åŸè°…å€¼è·å–è¡¨æƒ…emoji\n\t\tgetExpression(forgiveness) {\n\t\t\tconst val = forgiveness !== undefined ? forgiveness : this.forgiveness\n\t\t\tif (val <= 30) return 'ğŸ˜ ' // ç”Ÿæ°”\n\t\t\tif (val <= 50) return 'ğŸ˜‘' // ä¸­æ€§/ä¸å¼€å¿ƒ\n\t\t\tif (val <= 70) return 'ğŸ˜' // å¹³é™\n\t\t\tif (val <= 85) return 'ğŸ˜Š' // å¾®ç¬‘\n\t\t\treturn 'ğŸ˜„' // å¼€å¿ƒ\n\t\t},\n\t\t// æ ¹æ®åŸè°…å€¼è·å–é€šç”¨åœºæ™¯å¤´åƒï¼ˆä¸åŒºåˆ†å…·ä½“äººç‰©ï¼Œåªçœ‹æƒ…ç»ªï¼‰\n\t\tgetAiAvatar(forgiveness) {\n\t\t\t// å½“å‰åŸè°…å€¼ï¼ˆä¼˜å…ˆä½¿ç”¨æ¶ˆæ¯é‡Œçš„å€¼ï¼‰\n\t\t\tconst val = forgiveness !== undefined && forgiveness !== null ? forgiveness : this.forgiveness\n\n\t\t\t// åŸºäºåŸè°…å€¼åˆ’åˆ†æƒ…ç»ªé˜¶æ®µ\n\t\t\tlet mood = 'angry' // ç”Ÿæ°”\n\t\t\tif (val > 30 && val <= 60) mood = 'normal'   // ä¸€èˆ¬\n\t\t\telse if (val > 60 && val <= 85) mood = 'smile' // å¾®ç¬‘\n\t\t\telse if (val > 85) mood = 'happy'             // å¾ˆå¼€å¿ƒ\n\n\t\t\t// é€šç”¨å¤´åƒå‘½åè§„åˆ™ï¼ˆä¸åŒºåˆ†äººç‰©ï¼ŒåªåŒºåˆ†æƒ…ç»ªï¼‰ï¼š\n\t\t\t// éœ€è¦åœ¨ static/avatars ä¸‹å‡†å¤‡ 4 å¼ é€šç”¨ GIF å¤´åƒï¼š\n\t\t\t// /static/avatars/role_angry.gif   ï¼ˆç”Ÿæ°”ï¼‰\n\t\t\t// /static/avatars/role_normal.gif  ï¼ˆä¸€èˆ¬/å¹³é™ï¼‰\n\t\t\t// /static/avatars/role_smile.gif   ï¼ˆå¾®ç¬‘ï¼‰\n\t\t\t// /static/avatars/role_happy.gif   ï¼ˆå¾ˆå¼€å¿ƒï¼‰\n\t\t\t// å¦‚æœæ²¡æœ‰å¯¹åº”å›¾ç‰‡ï¼Œå¾®ä¿¡åªæ˜¯ä¸æ˜¾ç¤ºï¼Œä¸ä¼šå½±å“é€»è¾‘\n\t\t\treturn `/static/avatars/role_${mood}.gif`\n\t\t},\n\t\tloadUser() {\n\t\t\tconst storedAvatar = uni.getStorageSync('userAvatar')\n\t\t\tif (storedAvatar) {\n\t\t\t\tthis.userAvatar = storedAvatar\n\t\t\t} else {\n\t\t\t\tthis.userAvatar = '/static/user.png'\n\t\t\t}\n\t\t\tconst storedId = uni.getStorageSync('userId')\n\t\t\tthis.userId = storedId || this.genAnonId()\n\t\t\tif (!storedId) {\n\t\t\t\tuni.setStorageSync('userId', this.userId)\n\t\t\t}\n\t\t},\n\t\tgenAnonId() {\n\t\t\treturn `guest-${Math.random().toString(16).slice(2, 10)}`\n\t\t},\n\t\tasync initScene() {\n\t\t\tthis.loading = true\n\t\t\ttry {\n\t\t\t\tconst { data, error } = await sceneService.getSceneById(this.sceneId)\n\t\t\t\tif (error || !data) {\n\t\t\t\t\tuni.showToast({ title: 'åŠ è½½åœºæ™¯å¤±è´¥', icon: 'none' })\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.scene = data\n\t\t\t\tthis.forgiveness = data.initial_forgiveness ?? 40\n\t\t\t\tthis.startForgiveness = this.forgiveness\n\t\t\t\tthis.maxTurns = data.max_interactions || 10\n\t\t\t\tthis.currentTurn = 0\n\t\t\t\tthis.messages = []\n\t\t\t\tthis.forgivenessChanges = []\n\t\t\t\tthis.recordSaved = false\n\t\t\t\tthis.gameEnded = false\n\t\t\t\tthis.gameResult = { success: false, message: '' }\n\t\t\t\tthis.actionLocked = false\n\t\t\t\tthis.startTimestamp = Date.now()\n\t\t\t\t// åˆå§‹æ¶ˆæ¯ä½¿ç”¨åˆå§‹åŸè°…å€¼\n\t\t\t\tthis.appendMessage('ai', data.angry_reason || data.title || 'æˆ‘ç°åœ¨å¾ˆç”Ÿæ°”ï¼Œä½ è¯´è¯´çœ‹ã€‚', '', this.forgiveness)\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(err)\n\t\t\t\tuni.showToast({ title: 'åŠ è½½å¤±è´¥', icon: 'none' })\n\t\t\t} finally {\n\t\t\t\tthis.loading = false\n\t\t\t}\n\t\t},\n\t\tappendMessage(role, text, forgivenessChange = '', forgiveness = null) {\n\t\t\tconst id = `msg-${Date.now()}-${Math.random().toString(16).slice(2)}`\n\t\t\t// ä¿å­˜å½“å‰åŸè°…å€¼ï¼Œç”¨äºæ˜¾ç¤ºè¡¨æƒ…\n\t\t\tconst currentForgiveness = forgiveness !== null ? forgiveness : this.forgiveness\n\t\t\tthis.messages.push({ \n\t\t\t\tid, \n\t\t\t\trole, \n\t\t\t\ttext, \n\t\t\t\tforgivenessChange,\n\t\t\t\tforgiveness: currentForgiveness // ä¿å­˜æ¶ˆæ¯å‘é€æ—¶çš„åŸè°…å€¼\n\t\t\t})\n\t\t\tthis.lastMsgId = id\n\t\t},\n\t\tasync handleSend() {\n\t\t\tif (this.actionLocked) return\n\t\t\tconst content = this.inputText.trim()\n\t\t\tif (!content) {\n\t\t\t\tuni.showToast({ title: 'è¯·è¾“å…¥å†…å®¹', icon: 'none' })\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.inputText = ''\n\t\t\tthis.currentTurn++\n\t\t\tthis.appendMessage('user', content)\n\t\t\tthis.actionLocked = true\n\t\t\ttry {\n\t\t\t\t// ç»„è£…å†å²æ¶ˆæ¯ï¼ˆä»…å–æœ€è¿‘ 10 æ¡ï¼‰\n\t\t\t\tconst history = this.messages.slice(-10).map(m => ({\n\t\t\t\t\trole: m.role === 'ai' ? 'assistant' : 'user',\n\t\t\t\t\tcontent: m.text\n\t\t\t\t}))\n\n\t\t\t\tconst aiRes = await generateReply({\n\t\t\t\t\tscene: this.scene,\n\t\t\t\t\thistory,\n\t\t\t\t\tuserInput: content,\n\t\t\t\t\tforgiveness: this.forgiveness\n\t\t\t\t})\n\n\t\t\t\t// AI ä¸å¯ç”¨ï¼šä¸æ¶ˆè€—è½®æ¬¡ã€ä¸æ”¹å˜åŸè°…å€¼ï¼Œä»…æç¤º\n\t\t\t\tif (aiRes && aiRes.error) {\n\t\t\t\t\tthis.currentTurn = Math.max(0, this.currentTurn - 1)\n\t\t\t\t\tthis.appendMessage('ai', 'AI æš‚æ—¶ä¸èƒ½ä½¿ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚')\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tconst { reply, forgivenessDelta } = aiRes || {}\n\t\t\t\t// AI è¿”å›ç¼ºå­—æ®µä¹Ÿè§†ä¸ºä¸å¯ç”¨\n\t\t\t\tif (typeof reply !== 'string' || !reply.trim() || !Number.isFinite(forgivenessDelta)) {\n\t\t\t\t\tthis.currentTurn = Math.max(0, this.currentTurn - 1)\n\t\t\t\t\tthis.appendMessage('ai', 'AI æš‚æ—¶ä¸èƒ½ä½¿ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚')\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst delta = forgivenessDelta\n\n\t\t\t\tthis.forgiveness = this.clampForgiveness(this.forgiveness + delta)\n\t\t\t\tthis.forgivenessChanges.push({\n\t\t\t\t\tround: this.currentTurn,\n\t\t\t\t\tchange: delta,\n\t\t\t\t\tfinal: this.forgiveness\n\t\t\t\t})\n\t\t\t\tconst changeText = delta >= 0 ? `åŸè°…å€¼ +${delta}` : `åŸè°…å€¼ ${delta}`\n\t\t\t\t// ä¼ é€’æ›´æ–°åçš„åŸè°…å€¼ï¼Œç”¨äºæ˜¾ç¤ºè¡¨æƒ…\n\t\t\t\tthis.appendMessage('ai', reply, changeText, this.forgiveness)\n\t\t\t\tthis.checkResult()\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('AI å¤„ç†å¼‚å¸¸:', err)\n\t\t\t\t// å¼‚å¸¸åŒæ ·è§†ä¸º AI ä¸å¯ç”¨ï¼šä¸æ¶ˆè€—è½®æ¬¡ã€ä¸æ”¹å˜åŸè°…å€¼ï¼Œä»…æç¤º\n\t\t\t\tthis.currentTurn = Math.max(0, this.currentTurn - 1)\n\t\t\t\tthis.appendMessage('ai', 'AI æš‚æ—¶ä¸èƒ½ä½¿ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚')\n\t\t\t} finally {\n\t\t\t\tthis.actionLocked = false\n\t\t\t}\n\t\t},\n\t\tclampForgiveness(val) {\n\t\t\treturn Math.max(0, Math.min(100, val))\n\t\t},\n\t\tcheckResult() {\n\t\t\tif (this.forgiveness >= 100) {\n\t\t\t\tthis.forgiveness = 100\n\t\t\t\tthis.showResult(true)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (this.forgiveness <= 0) {\n\t\t\t\tthis.forgiveness = 0\n\t\t\t\tthis.showResult(false)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (this.currentTurn >= this.maxTurns) {\n\t\t\t\tthis.showResult(false, 'å·²ç”¨å®Œæ‰€æœ‰å¯¹è¯æ¬¡æ•°')\n\t\t\t}\n\t\t},\n\t\tshowResult(success, reason = '') {\n\t\t\tthis.actionLocked = true\n\t\t\tthis.gameEnded = true\n\t\t\tthis.persistRecord(success)\n\t\t\t\n\t\t\tif (success) {\n\t\t\t\tthis.gameResult = {\n\t\t\t\t\tsuccess: true,\n\t\t\t\t\tmessage: 'æ­å–œï¼Œå“„å¥½äº†ï¼åŸè°…å€¼è¾¾åˆ° 100ï¼Œèƒœåˆ©ï¼'\n\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\tthis.gameResult = {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: reason || `æŒ‘æˆ˜å¤±è´¥ï¼ŒåŸè°…å€¼ ${this.forgiveness}`\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t},\n\t\thandleRestart() {\n\t\t\tthis.initScene()\n\t\t},\n\t\thandleReturn() {\n\t\t\tuni.navigateBack()\n\t\t},\n\t\tasync persistRecord(isSuccess) {\n\t\t\t// é¿å…é‡å¤ä¿å­˜\n\t\t\tif (this.recordSaved) return\n\t\t\tthis.recordSaved = true\n\n\t\t\tconst durationSeconds = this.startTimestamp\n\t\t\t\t? Math.max(0, Math.round((Date.now() - this.startTimestamp) / 1000))\n\t\t\t\t: null\n\n\t\t\ttry {\n\t\t\t\tawait gameRecordService.createRecord({\n\t\t\t\t\tuserId: this.userId || this.genAnonId(),\n\t\t\t\t\tsceneId: this.sceneId,\n\t\t\t\t\tisSuccess,\n\t\t\t\t\tfinalForgiveness: this.forgiveness,\n\t\t\t\t\tinteractionCount: this.currentTurn,\n\t\t\t\t\tmaxInteractions: this.maxTurns,\n\t\t\t\t\tstartForgiveness: this.startForgiveness,\n\t\t\t\t\tforgivenessChanges: this.forgivenessChanges,\n\t\t\t\t\tdurationSeconds\n\t\t\t\t})\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('ä¿å­˜æ¸¸æˆè®°å½•å¤±è´¥:', err)\n\t\t\t}\n\t\t}\n\t}\n}\n</script>\n\n<style>\n.dialog-page {\n\tmin-height: 100vh;\n\tbackground-color: #f5f6fa;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.scene-header {\n\tpadding: 20rpx 24rpx 0 24rpx;\n}\n\n.scene-title {\n\tfont-size: 32rpx;\n\tfont-weight: 700;\n\tcolor: #222;\n\tmargin-bottom: 12rpx;\n}\n\n.meta-row {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 20rpx;\n}\n\n.meta-item {\n\tflex: 1;\n}\n\n.meta-label {\n\tfont-size: 24rpx;\n\tcolor: #666;\n\tmargin-bottom: 8rpx;\n\tdisplay: block;\n}\n\n.bar {\n\twidth: 100%;\n\theight: 12rpx;\n\tbackground: #e5e7eb;\n\tborder-radius: 12rpx;\n\toverflow: hidden;\n}\n\n.bar-fill {\n\theight: 100%;\n\tbackground: #ff6b6b;\n}\n\n.meta-value {\n\tfont-size: 24rpx;\n\tcolor: #333;\n\tmargin-top: 6rpx;\n\tdisplay: inline-block;\n}\n\n.turns {\n\tflex: 0 0 180rpx;\n\ttext-align: right;\n}\n\n.chat-list {\n\tflex: 1;\n\tpadding: 20rpx 16rpx;\n\tpadding-bottom: 140rpx;\n}\n\n/* æ¸¸æˆç»“æŸæ—¶å¢åŠ åº•éƒ¨é—´è·ï¼Œé¿å…è¢«æ¨ªå¹…é®æŒ¡ */\n.chat-list.game-ended {\n\tpadding-bottom: 280rpx;\n}\n\n.chat-item {\n\tdisplay: flex;\n\tmargin-bottom: 20rpx;\n}\n\n.chat-item.user {\n\tflex-direction: row-reverse;\n}\n\n.avatar-wrapper {\n\tposition: relative;\n\tmargin: 0 12rpx;\n}\n\n.avatar {\n\twidth: 64rpx;\n\theight: 64rpx;\n\tborder-radius: 50%;\n\tbackground: #ddd;\n}\n\n.avatar-expression {\n\tposition: absolute;\n\tbottom: -8rpx;\n\tright: -4rpx;\n\tfont-size: 32rpx;\n\tbackground: #fff;\n\tborder-radius: 50%;\n\twidth: 36rpx;\n\theight: 36rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tbox-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.15);\n\tline-height: 1;\n}\n\n.bubble {\n\tmax-width: 80%;\n\tpadding: 18rpx 20rpx;\n\tborder-radius: 20rpx;\n\tbackground: #fff;\n\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.04);\n\tcolor: #333;\n\tfont-size: 28rpx;\n\tline-height: 40rpx;\n}\n\n.chat-item.user .bubble {\n\tbackground: #4f46e5;\n\tcolor: #fff;\n}\n\n.msg-text {\n\tdisplay: block;\n}\n\n.forgive-change {\n\tdisplay: block;\n\tmargin-top: 8rpx;\n\tfont-size: 24rpx;\n\tcolor: #888;\n}\n\n.chat-item.user .forgive-change {\n\tcolor: #e5e7eb;\n}\n\n.input-area {\n\tposition: fixed;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tpadding: 12rpx 16rpx;\n\tbackground: #fff;\n\tbox-shadow: 0 -4rpx 10rpx rgba(0, 0, 0, 0.06);\n\tdisplay: flex;\n\talign-items: flex-end;\n\tgap: 12rpx;\n}\n\n.text-input {\n\tflex: 1;\n\tmin-height: 88rpx;\n\tbackground: #f5f5f5;\n\tborder-radius: 12rpx;\n\tpadding: 12rpx 16rpx;\n\tfont-size: 28rpx;\n\tline-height: 42rpx;\n\tbox-sizing: border-box;\n}\n\n.text-input.multiline {\n\tmax-height: 220rpx;\n}\n\n.send-btn {\n\theight: 88rpx;\n\tline-height: 88rpx;\n\tpadding: 0 32rpx;\n\tfont-size: 28rpx;\n\tborder-radius: 12rpx;\n\tbackground: linear-gradient(135deg, #4f46e5, #7c3aed);\n\tborder: none;\n}\n\n/* æ¸¸æˆç»“æŸæç¤º */\n.result-banner {\n\tposition: fixed;\n\tleft: 0;\n\tright: 0;\n\tbottom: 148rpx;\n\tpadding: 20rpx 24rpx;\n\tbackground: rgba(0, 0, 0, 0.8);\n\tz-index: 100;\n\ttext-align: center;\n}\n\n.result-banner.success {\n\tbackground: rgba(16, 185, 129, 0.9);\n}\n\n.result-banner.failed {\n\tbackground: rgba(239, 68, 68, 0.9);\n}\n\n.result-text {\n\tfont-size: 28rpx;\n\tcolor: #fff;\n\tfont-weight: 500;\n}\n\n/* æ“ä½œæŒ‰é’®åŒºåŸŸ */\n.action-buttons {\n\tposition: fixed;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tpadding: 20rpx 24rpx;\n\tbackground: #fff;\n\tbox-shadow: 0 -4rpx 10rpx rgba(0, 0, 0, 0.06);\n\tdisplay: flex;\n\tgap: 20rpx;\n\tz-index: 99;\n}\n\n.action-btn {\n\tflex: 1;\n\theight: 88rpx;\n\tline-height: 88rpx;\n\tborder-radius: 12rpx;\n\tfont-size: 30rpx;\n\tborder: none;\n}\n\n.restart-btn {\n\tbackground: #4f46e5;\n\tcolor: #fff;\n}\n\n.restart-btn:active {\n\tbackground: #4338ca;\n}\n\n.return-btn {\n\tbackground: #f5f5f5;\n\tcolor: #333;\n}\n\n.return-btn:active {\n\tbackground: #e0e0e0;\n}\n</style>\n\n","import MiniProgramPage from 'D:/Hbuilder/HBuilderX.4.76.2025082103/project/first/pages/dialog/dialog.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","generateReply","gameRecordService"],"mappings":"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"}