{"version":3,"file":"supabase-helper.js","sources":["utils/supabase-helper.js"],"sourcesContent":["/**\n * Supabase 数据库操作辅助函数\n * 封装常用的数据库操作，简化业务代码\n */\n\nimport { supabase, supabaseConfig } from '@/config/supabase.js'\n\n/**\n * 场景相关操作\n */\nexport const sceneService = {\n  /**\n   * 获取所有可用场景\n   */\n  async getAllScenes(options = {}) {\n    const {\n      category = null,\n      difficulty = null,\n      status = 'active',\n      limit = 50,\n      offset = 0,\n      orderBy = 'play_count',\n      order = 'desc'\n    } = options\n\n    const filters = []\n    if (category) filters.push(`category=eq.${encodeURIComponent(category)}`)\n    if (difficulty) filters.push(`difficulty=eq.${encodeURIComponent(difficulty)}`)\n    if (status) filters.push(`status=eq.${encodeURIComponent(status)}`)\n\n    const { data, error } = await supabase.select(supabaseConfig.tables.scenes, {\n      select: '*',\n      filters,\n      query: {\n        limit,\n        offset,\n        order: `${orderBy}.${order}`\n      }\n    })\n\n    return { data, error }\n  },\n\n  /**\n   * 根据分类获取场景\n   */\n  async getScenesByCategory(category) {\n    return this.getAllScenes({ category, status: 'active' })\n  },\n\n  /**\n   * 获取热门场景\n   */\n  async getPopularScenes(limit = 10) {\n    return this.getAllScenes({\n      status: 'active',\n      orderBy: 'play_count',\n      order: 'desc',\n      limit\n    })\n  },\n\n  /**\n   * 获取高胜率场景\n   */\n  async getHighWinRateScenes(limit = 10) {\n    return this.getAllScenes({\n      status: 'active',\n      orderBy: 'win_rate',\n      order: 'desc',\n      limit\n    })\n  },\n\n  /**\n   * 根据ID获取场景详情\n   */\n  async getSceneById(sceneId) {\n    const { data, error } = await supabase.select(supabaseConfig.tables.scenes, {\n      filters: [`id=eq.${sceneId}`]\n    })\n\n    if (error) return { data: null, error }\n    return { data: data && data[0] ? data[0] : null, error: null }\n  },\n\n  /**\n   * 搜索场景\n   */\n  async searchScenes(keyword) {\n    // 注意：Supabase 的全文搜索需要使用其他方式\n    // 这里使用简单的 LIKE 查询（PostgreSQL）\n    const { data, error } = await supabase.select(supabaseConfig.tables.scenes, {\n      filters: [\n        `title=ilike.%${encodeURIComponent(keyword)}%`,\n        `status=eq.active`\n      ]\n    })\n\n    return { data, error }\n  },\n\n  /**\n   * 更新场景统计数据（通常由触发器自动完成）\n   */\n  async updateSceneStats(sceneId) {\n    // 这个操作通常由数据库触发器自动完成\n    // 如果需要手动更新，可以调用此方法\n    const { data, error } = await supabase.update(\n      supabaseConfig.tables.scenes,\n      { id: sceneId },\n      { updated_at: new Date().toISOString() }\n    )\n\n    return { data, error }\n  }\n}\n\n/**\n * 用户相关操作\n */\nexport const userService = {\n  /**\n   * 创建或更新用户信息\n   */\n  async createOrUpdateUser(userData) {\n    const {\n      userId,\n      nickname,\n      avatarUrl,\n      loginType = 'guest',\n      wxOpenid = null\n    } = userData\n\n    // 先按 wx_openid 查（如果有），否则按 user_id 查\n    const filterKey = wxOpenid\n      ? `wx_openid=eq.${encodeURIComponent(wxOpenid)}`\n      : `user_id=eq.${encodeURIComponent(userId)}`\n\n    const { data: existingUser, error: queryError } = await supabase.select(\n      supabaseConfig.tables.users,\n      {\n        filters: [filterKey],\n        select: 'id,user_id'\n      }\n    )\n\n    if (queryError) {\n      return { data: null, error: queryError }\n    }\n\n    const userPayload = {\n      user_id: userId,\n      nickname: nickname || null,\n      avatar_url: avatarUrl || null,\n      login_type: loginType,\n      wx_openid: wxOpenid || null,\n      updated_at: new Date().toISOString()\n    }\n\n    if (existingUser && existingUser.length > 0) {\n      // 更新现有用户，优先用已存在的 user_id 进行更新\n      const targetUserId = existingUser[0].user_id || userId\n      const { data, error } = await supabase.update(\n        supabaseConfig.tables.users,\n        { user_id: targetUserId },\n        userPayload\n      )\n      return { data, error }\n    } else {\n      // 创建新用户\n      const { data, error } = await supabase.insert(supabaseConfig.tables.users, userPayload)\n      return { data, error }\n    }\n  },\n\n  /**\n   * 根据 user_id 获取用户信息\n   */\n  async getUserById(userId) {\n    const { data, error } = await supabase.select(supabaseConfig.tables.users, {\n      filters: [`user_id=eq.${encodeURIComponent(userId)}`]\n    })\n\n    if (error) return { data: null, error }\n    return { data: data && data[0] ? data[0] : null, error: null }\n  },\n\n  /**\n   * 根据微信 openid 获取用户信息\n   */\n  async getUserByWxOpenid(wxOpenid) {\n    const { data, error } = await supabase.select(supabaseConfig.tables.users, {\n      filters: [`wx_openid=eq.${encodeURIComponent(wxOpenid)}`]\n    })\n\n    if (error) return { data: null, error }\n    return { data: data && data[0] ? data[0] : null, error: null }\n  }\n}\n\n/**\n * 用户提交场景相关操作\n */\nexport const userSceneService = {\n  /**\n   * 提交自定义场景\n   */\n  async submitScene(sceneData) {\n    const {\n      userId,\n      userNickname,\n      title,\n      description,\n      category,\n      role,\n      roleGender,\n      angryReason,\n      expectedDifficulty\n    } = sceneData\n\n    const { data, error } = await supabase.insert(supabaseConfig.tables.userScenes, {\n      user_id: userId,\n      user_nickname: userNickname,\n      title,\n      description,\n      category,\n      role,\n      role_gender: roleGender || '其他',\n      angry_reason: angryReason,\n      expected_difficulty: expectedDifficulty || '中',\n      status: 'pending'\n    })\n\n    return { data, error }\n  },\n\n  /**\n   * 获取用户的提交记录\n   */\n  async getUserSubmissions(userId) {\n    const { data, error } = await supabase.select(supabaseConfig.tables.userScenes, {\n      filters: [`user_id=eq.${encodeURIComponent(userId)}`],\n      query: {\n        order: 'created_at.desc'\n      }\n    })\n\n    return { data, error }\n  }\n}\n\n/**\n * 游戏记录相关操作\n */\nexport const gameRecordService = {\n  /**\n   * 创建游戏记录\n   */\n  async createRecord(recordData) {\n    const {\n      userId,\n      sceneId,\n      isSuccess,\n      finalForgiveness,\n      interactionCount,\n      maxInteractions,\n      startForgiveness,\n      forgivenessChanges,\n      durationSeconds\n    } = recordData\n\n    const { data, error } = await supabase.insert(supabaseConfig.tables.gameRecords, {\n      user_id: userId,\n      scene_id: sceneId,\n      is_success: isSuccess,\n      final_forgiveness: finalForgiveness,\n      interaction_count: interactionCount,\n      max_interactions: maxInteractions,\n      start_forgiveness: startForgiveness,\n      forgiveness_changes: JSON.stringify(forgivenessChanges),\n      duration_seconds: durationSeconds,\n      ended_at: new Date().toISOString()\n    })\n\n    // 更新场景的更新时间，便于最近挑战排序\n    if (!error && sceneId) {\n      await supabase.update(\n        supabaseConfig.tables.scenes,\n        { id: sceneId },\n        { updated_at: new Date().toISOString() }\n      )\n    }\n\n    return { data, error }\n  },\n\n  /**\n   * 获取用户的游戏记录\n   */\n  async getUserRecords(userId, options = {}) {\n    const {\n      sceneId = null,\n      limit = 50,\n      offset = 0,\n      withScene = false\n    } = options\n\n    const filters = [`user_id=eq.${encodeURIComponent(userId)}`]\n    if (sceneId) filters.push(`scene_id=eq.${sceneId}`)\n\n    const { data, error } = await supabase.select(supabaseConfig.tables.gameRecords, {\n      filters,\n      select: withScene ? '*,scene:scenes(title)' : '*',\n      query: {\n        order: 'created_at.desc',\n        limit,\n        offset\n      }\n    })\n\n    return { data, error }\n  },\n\n  /**\n   * 获取用户最近挑战的唯一场景（去重后取前 N 条）\n   */\n  async getRecentScenes(userId, limit = 3) {\n    // 先多取一些记录，防止去重后不足\n    const { data, error } = await this.getUserRecords(userId, {\n      limit: limit * 5,\n      withScene: true\n    })\n\n    if (error || !data) return { data: null, error }\n\n    const seen = new Set()\n    const recent = []\n\n    for (const rec of data) {\n      if (seen.has(rec.scene_id)) continue\n      seen.add(rec.scene_id)\n      recent.push(rec)\n      if (recent.length >= limit) break\n    }\n\n    return { data: recent, error: null }\n  },\n\n  /**\n   * 获取用户的游戏统计\n   */\n  async getUserStats(userId) {\n    const { data, error } = await supabase.select(supabaseConfig.tables.gameRecords, {\n      filters: [`user_id=eq.${encodeURIComponent(userId)}`],\n      select: 'is_success,scene_id'\n    })\n\n    if (error) return { data: null, error }\n\n    const stats = {\n      totalGames: data.length,\n      successCount: data.filter(r => r.is_success).length,\n      successRate: data.length > 0 \n        ? ((data.filter(r => r.is_success).length / data.length) * 100).toFixed(2)\n        : 0,\n      uniqueScenes: new Set(data.map(r => r.scene_id)).size\n    }\n\n    return { data: stats, error: null }\n  },\n\n  /**\n   * 获取场景的游戏记录统计\n   */\n  async getSceneRecords(sceneId, limit = 100) {\n    const { data, error } = await supabase.select(supabaseConfig.tables.gameRecords, {\n      filters: [`scene_id=eq.${sceneId}`],\n      query: {\n        order: 'created_at.desc',\n        limit\n      }\n    })\n\n    return { data, error }\n  },\n\n  /**\n   * 获取所有场景的全局统计（总挑战次数 & 平均胜率）\n   * 用于首页场景卡片展示\n   */\n  async getGlobalSceneStats(limit = 10000) {\n    const { data, error } = await supabase.select(supabaseConfig.tables.gameRecords, {\n      select: 'scene_id,is_success',\n      query: {\n        limit\n      }\n    })\n\n    if (error || !data) return { data: null, error }\n\n    const statsMap = {}\n\n    data.forEach(rec => {\n      const sid = rec.scene_id\n      if (!sid) return\n      if (!statsMap[sid]) {\n        statsMap[sid] = {\n          playCount: 0,\n          winCount: 0\n        }\n      }\n      statsMap[sid].playCount += 1\n      if (rec.is_success) {\n        statsMap[sid].winCount += 1\n      }\n    })\n\n    // 计算胜率\n    Object.keys(statsMap).forEach(sid => {\n      const { playCount, winCount } = statsMap[sid]\n      const rate = playCount > 0 ? (winCount / playCount) * 100 : 0\n      statsMap[sid].winRate = Number(rate.toFixed(1))\n    })\n\n    return { data: statsMap, error: null }\n  }\n}\n\n/**\n * 工具函数\n */\nexport const supabaseHelper = {\n  /**\n   * 格式化原谅值变化数据\n   */\n  formatForgivenessChanges(changes) {\n    if (typeof changes === 'string') {\n      try {\n        return JSON.parse(changes)\n      } catch (e) {\n        return []\n      }\n    }\n    return changes || []\n  },\n\n  /**\n   * 计算难度标签（根据胜率）\n   */\n  calculateDifficulty(winRate) {\n    if (winRate >= 60) return '易'\n    if (winRate >= 30) return '中'\n    return '难'\n  },\n\n  /**\n   * 处理 Supabase 错误\n   */\n  handleError(error) {\n    if (!error) return '未知错误'\n    \n    if (typeof error === 'string') return error\n    if (error.message) return error.message\n    if (error.error_description) return error.error_description\n    \n    return '操作失败，请稍后重试'\n  }\n}\n\nexport default {\n  sceneService,\n  userSceneService,\n  gameRecordService,\n  supabaseHelper\n}\n\n"],"names":["supabase","supabaseConfig"],"mappings":";;AAUY,MAAC,eAAe;AAAA;AAAA;AAAA;AAAA,EAI1B,MAAM,aAAa,UAAU,IAAI;AAC/B,UAAM;AAAA,MACJ,WAAW;AAAA,MACX,aAAa;AAAA,MACb,SAAS;AAAA,MACT,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,UAAU;AAAA,MACV,QAAQ;AAAA,IACd,IAAQ;AAEJ,UAAM,UAAU,CAAE;AAClB,QAAI;AAAU,cAAQ,KAAK,eAAe,mBAAmB,QAAQ,CAAC,EAAE;AACxE,QAAI;AAAY,cAAQ,KAAK,iBAAiB,mBAAmB,UAAU,CAAC,EAAE;AAC9E,QAAI;AAAQ,cAAQ,KAAK,aAAa,mBAAmB,MAAM,CAAC,EAAE;AAElE,UAAM,EAAE,MAAM,UAAU,MAAMA,gBAAQ,SAAC,OAAOC,gBAAAA,eAAe,OAAO,QAAQ;AAAA,MAC1E,QAAQ;AAAA,MACR;AAAA,MACA,OAAO;AAAA,QACL;AAAA,QACA;AAAA,QACA,OAAO,GAAG,OAAO,IAAI,KAAK;AAAA,MAC3B;AAAA,IACP,CAAK;AAED,WAAO,EAAE,MAAM,MAAO;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,oBAAoB,UAAU;AAClC,WAAO,KAAK,aAAa,EAAE,UAAU,QAAQ,SAAQ,CAAE;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,iBAAiB,QAAQ,IAAI;AACjC,WAAO,KAAK,aAAa;AAAA,MACvB,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,OAAO;AAAA,MACP;AAAA,IACN,CAAK;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,qBAAqB,QAAQ,IAAI;AACrC,WAAO,KAAK,aAAa;AAAA,MACvB,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,OAAO;AAAA,MACP;AAAA,IACN,CAAK;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,aAAa,SAAS;AAC1B,UAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC,OAAOC,gBAAAA,eAAe,OAAO,QAAQ;AAAA,MAC1E,SAAS,CAAC,SAAS,OAAO,EAAE;AAAA,IAClC,CAAK;AAED,QAAI;AAAO,aAAO,EAAE,MAAM,MAAM,MAAO;AACvC,WAAO,EAAE,MAAM,QAAQ,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,MAAM,OAAO,KAAM;AAAA,EAC/D;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,aAAa,SAAS;AAG1B,UAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC,OAAOC,gBAAAA,eAAe,OAAO,QAAQ;AAAA,MAC1E,SAAS;AAAA,QACP,gBAAgB,mBAAmB,OAAO,CAAC;AAAA,QAC3C;AAAA,MACD;AAAA,IACP,CAAK;AAED,WAAO,EAAE,MAAM,MAAO;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,iBAAiB,SAAS;AAG9B,UAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC;AAAA,MACrCC,gBAAc,eAAC,OAAO;AAAA,MACtB,EAAE,IAAI,QAAS;AAAA,MACf,EAAE,aAAY,oBAAI,KAAM,GAAC,YAAW,EAAI;AAAA,IACzC;AAED,WAAO,EAAE,MAAM,MAAO;AAAA,EACvB;AACH;AAKY,MAAC,cAAc;AAAA;AAAA;AAAA;AAAA,EAIzB,MAAM,mBAAmB,UAAU;AACjC,UAAM;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA,YAAY;AAAA,MACZ,WAAW;AAAA,IACjB,IAAQ;AAGJ,UAAM,YAAY,WACd,gBAAgB,mBAAmB,QAAQ,CAAC,KAC5C,cAAc,mBAAmB,MAAM,CAAC;AAE5C,UAAM,EAAE,MAAM,cAAc,OAAO,WAAY,IAAG,MAAMD,gBAAAA,SAAS;AAAA,MAC/DC,gBAAc,eAAC,OAAO;AAAA,MACtB;AAAA,QACE,SAAS,CAAC,SAAS;AAAA,QACnB,QAAQ;AAAA,MACT;AAAA,IACF;AAED,QAAI,YAAY;AACd,aAAO,EAAE,MAAM,MAAM,OAAO,WAAY;AAAA,IACzC;AAED,UAAM,cAAc;AAAA,MAClB,SAAS;AAAA,MACT,UAAU,YAAY;AAAA,MACtB,YAAY,aAAa;AAAA,MACzB,YAAY;AAAA,MACZ,WAAW,YAAY;AAAA,MACvB,aAAY,oBAAI,KAAM,GAAC,YAAa;AAAA,IACrC;AAED,QAAI,gBAAgB,aAAa,SAAS,GAAG;AAE3C,YAAM,eAAe,aAAa,CAAC,EAAE,WAAW;AAChD,YAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC;AAAA,QACrCC,gBAAc,eAAC,OAAO;AAAA,QACtB,EAAE,SAAS,aAAc;AAAA,QACzB;AAAA,MACD;AACD,aAAO,EAAE,MAAM,MAAO;AAAA,IAC5B,OAAW;AAEL,YAAM,EAAE,MAAM,MAAK,IAAK,MAAMD,gBAAAA,SAAS,OAAOC,+BAAe,OAAO,OAAO,WAAW;AACtF,aAAO,EAAE,MAAM,MAAO;AAAA,IACvB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,YAAY,QAAQ;AACxB,UAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC,OAAOC,gBAAAA,eAAe,OAAO,OAAO;AAAA,MACzE,SAAS,CAAC,cAAc,mBAAmB,MAAM,CAAC,EAAE;AAAA,IAC1D,CAAK;AAED,QAAI;AAAO,aAAO,EAAE,MAAM,MAAM,MAAO;AACvC,WAAO,EAAE,MAAM,QAAQ,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,MAAM,OAAO,KAAM;AAAA,EAC/D;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,kBAAkB,UAAU;AAChC,UAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC,OAAOC,gBAAAA,eAAe,OAAO,OAAO;AAAA,MACzE,SAAS,CAAC,gBAAgB,mBAAmB,QAAQ,CAAC,EAAE;AAAA,IAC9D,CAAK;AAED,QAAI;AAAO,aAAO,EAAE,MAAM,MAAM,MAAO;AACvC,WAAO,EAAE,MAAM,QAAQ,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,MAAM,OAAO,KAAM;AAAA,EAC/D;AACH;AAKY,MAAC,mBAAmB;AAAA;AAAA;AAAA;AAAA,EAI9B,MAAM,YAAY,WAAW;AAC3B,UAAM;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACN,IAAQ;AAEJ,UAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC,OAAOC,gBAAAA,eAAe,OAAO,YAAY;AAAA,MAC9E,SAAS;AAAA,MACT,eAAe;AAAA,MACf;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,aAAa,cAAc;AAAA,MAC3B,cAAc;AAAA,MACd,qBAAqB,sBAAsB;AAAA,MAC3C,QAAQ;AAAA,IACd,CAAK;AAED,WAAO,EAAE,MAAM,MAAO;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,mBAAmB,QAAQ;AAC/B,UAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC,OAAOC,gBAAAA,eAAe,OAAO,YAAY;AAAA,MAC9E,SAAS,CAAC,cAAc,mBAAmB,MAAM,CAAC,EAAE;AAAA,MACpD,OAAO;AAAA,QACL,OAAO;AAAA,MACR;AAAA,IACP,CAAK;AAED,WAAO,EAAE,MAAM,MAAO;AAAA,EACvB;AACH;AAKY,MAAC,oBAAoB;AAAA;AAAA;AAAA;AAAA,EAI/B,MAAM,aAAa,YAAY;AAC7B,UAAM;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACN,IAAQ;AAEJ,UAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC,OAAOC,gBAAAA,eAAe,OAAO,aAAa;AAAA,MAC/E,SAAS;AAAA,MACT,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,mBAAmB;AAAA,MACnB,mBAAmB;AAAA,MACnB,kBAAkB;AAAA,MAClB,mBAAmB;AAAA,MACnB,qBAAqB,KAAK,UAAU,kBAAkB;AAAA,MACtD,kBAAkB;AAAA,MAClB,WAAU,oBAAI,KAAM,GAAC,YAAa;AAAA,IACxC,CAAK;AAGD,QAAI,CAAC,SAAS,SAAS;AACrB,YAAMD,gBAAQ,SAAC;AAAA,QACbC,gBAAc,eAAC,OAAO;AAAA,QACtB,EAAE,IAAI,QAAS;AAAA,QACf,EAAE,aAAY,oBAAI,KAAM,GAAC,YAAW,EAAI;AAAA,MACzC;AAAA,IACF;AAED,WAAO,EAAE,MAAM,MAAO;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,eAAe,QAAQ,UAAU,IAAI;AACzC,UAAM;AAAA,MACJ,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,YAAY;AAAA,IAClB,IAAQ;AAEJ,UAAM,UAAU,CAAC,cAAc,mBAAmB,MAAM,CAAC,EAAE;AAC3D,QAAI;AAAS,cAAQ,KAAK,eAAe,OAAO,EAAE;AAElD,UAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC,OAAOC,gBAAAA,eAAe,OAAO,aAAa;AAAA,MAC/E;AAAA,MACA,QAAQ,YAAY,0BAA0B;AAAA,MAC9C,OAAO;AAAA,QACL,OAAO;AAAA,QACP;AAAA,QACA;AAAA,MACD;AAAA,IACP,CAAK;AAED,WAAO,EAAE,MAAM,MAAO;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,gBAAgB,QAAQ,QAAQ,GAAG;AAEvC,UAAM,EAAE,MAAM,MAAK,IAAK,MAAM,KAAK,eAAe,QAAQ;AAAA,MACxD,OAAO,QAAQ;AAAA,MACf,WAAW;AAAA,IACjB,CAAK;AAED,QAAI,SAAS,CAAC;AAAM,aAAO,EAAE,MAAM,MAAM,MAAO;AAEhD,UAAM,OAAO,oBAAI,IAAK;AACtB,UAAM,SAAS,CAAE;AAEjB,eAAW,OAAO,MAAM;AACtB,UAAI,KAAK,IAAI,IAAI,QAAQ;AAAG;AAC5B,WAAK,IAAI,IAAI,QAAQ;AACrB,aAAO,KAAK,GAAG;AACf,UAAI,OAAO,UAAU;AAAO;AAAA,IAC7B;AAED,WAAO,EAAE,MAAM,QAAQ,OAAO,KAAM;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,aAAa,QAAQ;AACzB,UAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC,OAAOC,gBAAAA,eAAe,OAAO,aAAa;AAAA,MAC/E,SAAS,CAAC,cAAc,mBAAmB,MAAM,CAAC,EAAE;AAAA,MACpD,QAAQ;AAAA,IACd,CAAK;AAED,QAAI;AAAO,aAAO,EAAE,MAAM,MAAM,MAAO;AAEvC,UAAM,QAAQ;AAAA,MACZ,YAAY,KAAK;AAAA,MACjB,cAAc,KAAK,OAAO,OAAK,EAAE,UAAU,EAAE;AAAA,MAC7C,aAAa,KAAK,SAAS,KACrB,KAAK,OAAO,OAAK,EAAE,UAAU,EAAE,SAAS,KAAK,SAAU,KAAK,QAAQ,CAAC,IACvE;AAAA,MACJ,cAAc,IAAI,IAAI,KAAK,IAAI,OAAK,EAAE,QAAQ,CAAC,EAAE;AAAA,IAClD;AAED,WAAO,EAAE,MAAM,OAAO,OAAO,KAAM;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,gBAAgB,SAAS,QAAQ,KAAK;AAC1C,UAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC,OAAOC,gBAAAA,eAAe,OAAO,aAAa;AAAA,MAC/E,SAAS,CAAC,eAAe,OAAO,EAAE;AAAA,MAClC,OAAO;AAAA,QACL,OAAO;AAAA,QACP;AAAA,MACD;AAAA,IACP,CAAK;AAED,WAAO,EAAE,MAAM,MAAO;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMD,MAAM,oBAAoB,QAAQ,KAAO;AACvC,UAAM,EAAE,MAAM,UAAU,MAAMD,gBAAQ,SAAC,OAAOC,gBAAAA,eAAe,OAAO,aAAa;AAAA,MAC/E,QAAQ;AAAA,MACR,OAAO;AAAA,QACL;AAAA,MACD;AAAA,IACP,CAAK;AAED,QAAI,SAAS,CAAC;AAAM,aAAO,EAAE,MAAM,MAAM,MAAO;AAEhD,UAAM,WAAW,CAAE;AAEnB,SAAK,QAAQ,SAAO;AAClB,YAAM,MAAM,IAAI;AAChB,UAAI,CAAC;AAAK;AACV,UAAI,CAAC,SAAS,GAAG,GAAG;AAClB,iBAAS,GAAG,IAAI;AAAA,UACd,WAAW;AAAA,UACX,UAAU;AAAA,QACX;AAAA,MACF;AACD,eAAS,GAAG,EAAE,aAAa;AAC3B,UAAI,IAAI,YAAY;AAClB,iBAAS,GAAG,EAAE,YAAY;AAAA,MAC3B;AAAA,IACP,CAAK;AAGD,WAAO,KAAK,QAAQ,EAAE,QAAQ,SAAO;AACnC,YAAM,EAAE,WAAW,aAAa,SAAS,GAAG;AAC5C,YAAM,OAAO,YAAY,IAAK,WAAW,YAAa,MAAM;AAC5D,eAAS,GAAG,EAAE,UAAU,OAAO,KAAK,QAAQ,CAAC,CAAC;AAAA,IACpD,CAAK;AAED,WAAO,EAAE,MAAM,UAAU,OAAO,KAAM;AAAA,EACvC;AACH;;;;;"}