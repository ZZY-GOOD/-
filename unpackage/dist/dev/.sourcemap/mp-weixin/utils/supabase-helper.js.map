{"version":3,"file":"supabase-helper.js","sources":["utils/supabase-helper.js"],"sourcesContent":["/**\r\n * Supabase 数据库操作辅助函数\r\n * 封装常用的数据库操作，简化业务代码\r\n */\r\n\r\nimport { supabase, supabaseConfig } from '@/config/supabase.js'\r\n\r\n/**\r\n * 场景相关操作\r\n */\r\nexport const sceneService = {\r\n  /**\r\n   * 获取所有可用场景\r\n   */\r\n  async getAllScenes(options = {}) {\r\n    const {\r\n      category = null,\r\n      difficulty = null,\r\n      status = 'active',\r\n      limit = 50,\r\n      offset = 0,\r\n      orderBy = 'play_count',\r\n      order = 'desc'\r\n    } = options\r\n\r\n    const filters = []\r\n    if (category) filters.push(`category=eq.${encodeURIComponent(category)}`)\r\n    if (difficulty) filters.push(`difficulty=eq.${encodeURIComponent(difficulty)}`)\r\n    if (status) filters.push(`status=eq.${encodeURIComponent(status)}`)\r\n\r\n    const { data, error } = await supabase.select(supabaseConfig.tables.scenes, {\r\n      select: '*',\r\n      filters,\r\n      query: {\r\n        limit,\r\n        offset,\r\n        order: `${orderBy}.${order}`\r\n      }\r\n    })\r\n\r\n    return { data, error }\r\n  },\r\n\r\n  /**\r\n   * 根据分类获取场景\r\n   */\r\n  async getScenesByCategory(category) {\r\n    return this.getAllScenes({ category, status: 'active' })\r\n  },\r\n\r\n  /**\r\n   * 获取热门场景\r\n   */\r\n  async getPopularScenes(limit = 10) {\r\n    return this.getAllScenes({\r\n      status: 'active',\r\n      orderBy: 'play_count',\r\n      order: 'desc',\r\n      limit\r\n    })\r\n  },\r\n\r\n  /**\r\n   * 获取高胜率场景\r\n   */\r\n  async getHighWinRateScenes(limit = 10) {\r\n    return this.getAllScenes({\r\n      status: 'active',\r\n      orderBy: 'win_rate',\r\n      order: 'desc',\r\n      limit\r\n    })\r\n  },\r\n\r\n  /**\r\n   * 根据ID获取场景详情\r\n   */\r\n  async getSceneById(sceneId) {\r\n    const { data, error } = await supabase.select(supabaseConfig.tables.scenes, {\r\n      filters: [`id=eq.${sceneId}`]\r\n    })\r\n\r\n    if (error) return { data: null, error }\r\n    return { data: data && data[0] ? data[0] : null, error: null }\r\n  },\r\n\r\n  /**\r\n   * 搜索场景\r\n   */\r\n  async searchScenes(keyword) {\r\n    // 注意：Supabase 的全文搜索需要使用其他方式\r\n    // 这里使用简单的 LIKE 查询（PostgreSQL）\r\n    const { data, error } = await supabase.select(supabaseConfig.tables.scenes, {\r\n      filters: [\r\n        `title=ilike.%${encodeURIComponent(keyword)}%`,\r\n        `status=eq.active`\r\n      ]\r\n    })\r\n\r\n    return { data, error }\r\n  },\r\n\r\n  /**\r\n   * 更新场景统计数据（通常由触发器自动完成）\r\n   */\r\n  async updateSceneStats(sceneId) {\r\n    // 这个操作通常由数据库触发器自动完成\r\n    // 如果需要手动更新，可以调用此方法\r\n    const { data, error } = await supabase.update(\r\n      supabaseConfig.tables.scenes,\r\n      { id: sceneId },\r\n      { updated_at: new Date().toISOString() }\r\n    )\r\n\r\n    return { data, error }\r\n  }\r\n}\r\n\r\n/**\r\n * 用户相关操作\r\n */\r\nexport const userService = {\r\n  /**\r\n   * 创建或更新用户信息\r\n   */\r\n  async createOrUpdateUser(userData) {\r\n    const {\r\n      userId,\r\n      nickname,\r\n      avatarUrl,\r\n      loginType = 'guest',\r\n      wxOpenid = null\r\n    } = userData\r\n\r\n    // 先查询用户是否存在\r\n    const { data: existingUser, error: queryError } = await supabase.select(\r\n      supabaseConfig.tables.users,\r\n      {\r\n        filters: [`user_id=eq.${encodeURIComponent(userId)}`],\r\n        select: 'id'\r\n      }\r\n    )\r\n\r\n    if (queryError) {\r\n      return { data: null, error: queryError }\r\n    }\r\n\r\n    const userPayload = {\r\n      user_id: userId,\r\n      nickname: nickname || null,\r\n      avatar_url: avatarUrl || null,\r\n      login_type: loginType,\r\n      wx_openid: wxOpenid || null,\r\n      updated_at: new Date().toISOString()\r\n    }\r\n\r\n    if (existingUser && existingUser.length > 0) {\r\n      // 更新现有用户\r\n      const { data, error } = await supabase.update(\r\n        supabaseConfig.tables.users,\r\n        { user_id: userId },\r\n        userPayload\r\n      )\r\n      return { data, error }\r\n    } else {\r\n      // 创建新用户\r\n      const { data, error } = await supabase.insert(supabaseConfig.tables.users, userPayload)\r\n      return { data, error }\r\n    }\r\n  },\r\n\r\n  /**\r\n   * 根据 user_id 获取用户信息\r\n   */\r\n  async getUserById(userId) {\r\n    const { data, error } = await supabase.select(supabaseConfig.tables.users, {\r\n      filters: [`user_id=eq.${encodeURIComponent(userId)}`]\r\n    })\r\n\r\n    if (error) return { data: null, error }\r\n    return { data: data && data[0] ? data[0] : null, error: null }\r\n  },\r\n\r\n  /**\r\n   * 根据微信 openid 获取用户信息\r\n   */\r\n  async getUserByWxOpenid(wxOpenid) {\r\n    const { data, error } = await supabase.select(supabaseConfig.tables.users, {\r\n      filters: [`wx_openid=eq.${encodeURIComponent(wxOpenid)}`]\r\n    })\r\n\r\n    if (error) return { data: null, error }\r\n    return { data: data && data[0] ? data[0] : null, error: null }\r\n  }\r\n}\r\n\r\n/**\r\n * 用户提交场景相关操作\r\n */\r\nexport const userSceneService = {\r\n  /**\r\n   * 提交自定义场景\r\n   */\r\n  async submitScene(sceneData) {\r\n    const {\r\n      userId,\r\n      userNickname,\r\n      title,\r\n      description,\r\n      category,\r\n      role,\r\n      roleGender,\r\n      angryReason,\r\n      expectedDifficulty\r\n    } = sceneData\r\n\r\n    const { data, error } = await supabase.insert(supabaseConfig.tables.userScenes, {\r\n      user_id: userId,\r\n      user_nickname: userNickname,\r\n      title,\r\n      description,\r\n      category,\r\n      role,\r\n      role_gender: roleGender || '其他',\r\n      angry_reason: angryReason,\r\n      expected_difficulty: expectedDifficulty || '中',\r\n      status: 'pending'\r\n    })\r\n\r\n    return { data, error }\r\n  },\r\n\r\n  /**\r\n   * 获取用户的提交记录\r\n   */\r\n  async getUserSubmissions(userId) {\r\n    const { data, error } = await supabase.select(supabaseConfig.tables.userScenes, {\r\n      filters: [`user_id=eq.${encodeURIComponent(userId)}`],\r\n      query: {\r\n        order: 'created_at.desc'\r\n      }\r\n    })\r\n\r\n    return { data, error }\r\n  }\r\n}\r\n\r\n/**\r\n * 游戏记录相关操作\r\n */\r\nexport const gameRecordService = {\r\n  /**\r\n   * 创建游戏记录\r\n   */\r\n  async createRecord(recordData) {\r\n    const {\r\n      userId,\r\n      sceneId,\r\n      isSuccess,\r\n      finalForgiveness,\r\n      interactionCount,\r\n      maxInteractions,\r\n      startForgiveness,\r\n      forgivenessChanges,\r\n      durationSeconds\r\n    } = recordData\r\n\r\n    const { data, error } = await supabase.insert(supabaseConfig.tables.gameRecords, {\r\n      user_id: userId,\r\n      scene_id: sceneId,\r\n      is_success: isSuccess,\r\n      final_forgiveness: finalForgiveness,\r\n      interaction_count: interactionCount,\r\n      max_interactions: maxInteractions,\r\n      start_forgiveness: startForgiveness,\r\n      forgiveness_changes: JSON.stringify(forgivenessChanges),\r\n      duration_seconds: durationSeconds,\r\n      ended_at: new Date().toISOString()\r\n    })\r\n\r\n    // 更新场景的更新时间，便于最近挑战排序\r\n    if (!error && sceneId) {\r\n      await supabase.update(\r\n        supabaseConfig.tables.scenes,\r\n        { id: sceneId },\r\n        { updated_at: new Date().toISOString() }\r\n      )\r\n    }\r\n\r\n    return { data, error }\r\n  },\r\n\r\n  /**\r\n   * 获取用户的游戏记录\r\n   */\r\n  async getUserRecords(userId, options = {}) {\r\n    const {\r\n      sceneId = null,\r\n      limit = 50,\r\n      offset = 0,\r\n      withScene = false\r\n    } = options\r\n\r\n    const filters = [`user_id=eq.${encodeURIComponent(userId)}`]\r\n    if (sceneId) filters.push(`scene_id=eq.${sceneId}`)\r\n\r\n    const { data, error } = await supabase.select(supabaseConfig.tables.gameRecords, {\r\n      filters,\r\n      select: withScene ? '*,scene:scenes(title)' : '*',\r\n      query: {\r\n        order: 'created_at.desc',\r\n        limit,\r\n        offset\r\n      }\r\n    })\r\n\r\n    return { data, error }\r\n  },\r\n\r\n  /**\r\n   * 获取用户最近挑战的唯一场景（去重后取前 N 条）\r\n   */\r\n  async getRecentScenes(userId, limit = 3) {\r\n    // 先多取一些记录，防止去重后不足\r\n    const { data, error } = await this.getUserRecords(userId, {\r\n      limit: limit * 5,\r\n      withScene: true\r\n    })\r\n\r\n    if (error || !data) return { data: null, error }\r\n\r\n    const seen = new Set()\r\n    const recent = []\r\n\r\n    for (const rec of data) {\r\n      if (seen.has(rec.scene_id)) continue\r\n      seen.add(rec.scene_id)\r\n      recent.push(rec)\r\n      if (recent.length >= limit) break\r\n    }\r\n\r\n    return { data: recent, error: null }\r\n  },\r\n\r\n  /**\r\n   * 获取用户的游戏统计\r\n   */\r\n  async getUserStats(userId) {\r\n    const { data, error } = await supabase.select(supabaseConfig.tables.gameRecords, {\r\n      filters: [`user_id=eq.${encodeURIComponent(userId)}`],\r\n      select: 'is_success,scene_id'\r\n    })\r\n\r\n    if (error) return { data: null, error }\r\n\r\n    const stats = {\r\n      totalGames: data.length,\r\n      successCount: data.filter(r => r.is_success).length,\r\n      successRate: data.length > 0 \r\n        ? ((data.filter(r => r.is_success).length / data.length) * 100).toFixed(2)\r\n        : 0,\r\n      uniqueScenes: new Set(data.map(r => r.scene_id)).size\r\n    }\r\n\r\n    return { data: stats, error: null }\r\n  },\r\n\r\n  /**\r\n   * 获取场景的游戏记录统计\r\n   */\r\n  async getSceneRecords(sceneId, limit = 100) {\r\n    const { data, error } = await supabase.select(supabaseConfig.tables.gameRecords, {\r\n      filters: [`scene_id=eq.${sceneId}`],\r\n      query: {\r\n        order: 'created_at.desc',\r\n        limit\r\n      }\r\n    })\r\n\r\n    return { data, error }\r\n  },\r\n\r\n  /**\r\n   * 获取所有场景的全局统计（总挑战次数 & 平均胜率）\r\n   * 用于首页场景卡片展示\r\n   */\r\n  async getGlobalSceneStats(limit = 10000) {\r\n    const { data, error } = await supabase.select(supabaseConfig.tables.gameRecords, {\r\n      select: 'scene_id,is_success',\r\n      query: {\r\n        limit\r\n      }\r\n    })\r\n\r\n    if (error || !data) return { data: null, error }\r\n\r\n    const statsMap = {}\r\n\r\n    data.forEach(rec => {\r\n      const sid = rec.scene_id\r\n      if (!sid) return\r\n      if (!statsMap[sid]) {\r\n        statsMap[sid] = {\r\n          playCount: 0,\r\n          winCount: 0\r\n        }\r\n      }\r\n      statsMap[sid].playCount += 1\r\n      if (rec.is_success) {\r\n        statsMap[sid].winCount += 1\r\n      }\r\n    })\r\n\r\n    // 计算胜率\r\n    Object.keys(statsMap).forEach(sid => {\r\n      const { playCount, winCount } = statsMap[sid]\r\n      const rate = playCount > 0 ? (winCount / playCount) * 100 : 0\r\n      statsMap[sid].winRate = Number(rate.toFixed(1))\r\n    })\r\n\r\n    return { data: statsMap, error: null }\r\n  }\r\n}\r\n\r\n/**\r\n * 工具函数\r\n */\r\nexport const supabaseHelper = {\r\n  /**\r\n   * 格式化原谅值变化数据\r\n   */\r\n  formatForgivenessChanges(changes) {\r\n    if (typeof changes === 'string') {\r\n      try {\r\n        return JSON.parse(changes)\r\n      } catch (e) {\r\n        return []\r\n      }\r\n    }\r\n    return changes || []\r\n  },\r\n\r\n  /**\r\n   * 计算难度标签（根据胜率）\r\n   */\r\n  calculateDifficulty(winRate) {\r\n    if (winRate >= 60) return '易'\r\n    if (winRate >= 30) return '中'\r\n    return '难'\r\n  },\r\n\r\n  /**\r\n   * 处理 Supabase 错误\r\n   */\r\n  handleError(error) {\r\n    if (!error) return '未知错误'\r\n    \r\n    if (typeof error === 'string') return error\r\n    if (error.message) return error.message\r\n    if (error.error_description) return error.error_description\r\n    \r\n    return '操作失败，请稍后重试'\r\n  }\r\n}\r\n\r\nexport default {\r\n  sceneService,\r\n  userSceneService,\r\n  gameRecordService,\r\n  supabaseHelper\r\n}\r\n\r\n"],"names":["supabase","supabaseConfig"],"mappings":"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"}